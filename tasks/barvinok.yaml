---

- name: Get libBarvinok sources
  git: repo=http://repo.or.cz/barvinok.git
       dest=/home/jmct/barvinok
       accept_hostkey=yes
       update=no

- name: Get Barvinok submodules
  shell: ./get_submodules.sh && touch /home/jmct/.barvinok_submoduled
  args:
    chdir: /home/jmct/barvinok
    creates: /home/jmct/.barvinok_submoduled

- name: Create configuration
  shell: sh autogen.sh
  args:
    chdir: /home/jmct/barvinok
    creates: /home/jmct/barvinok/configure

- name: run configure for Barvinok
  become: yes
  shell: ./configure
  args:
    chdir: /home/jmct/barvinok
    creates: /home/jmct/barvinok/Makefile

- name: make Barvinok
  become: yes
  shell: make
  args:
    chdir: /home/jmct/barvinok
    creates: /home/jmct/barviok/barvinok_count

- name: make check Barvinok
  become: yes
  shell: make check && touch /home/jmct/.barvinok_checked
  args:
    chdir: /home/jmct/barvinok
    creates: /home/jmct/.barvinok_checked

- name: make install Barvinok
  become: yes
  shell: make install
  args:
    chdir: /home/jmct/barvinok
    creates: /usr/local/bin/barvinok_count

- name: Install latte2polylib.pl
  become: yes
  shell: cp latte2polylib.pl /usr/local/bin/latte2polylib
  args:
    chdir: /home/jmct/barvinok
    creates: /usr/local/bin/latte2polylib
