---
title: "Credible Intervals for Beta Distributions"
author: "Chad Scherrer"
date: "April 1, 2016"
output: html_document
---

A beta distrbution has two parameters, usually confusingly called $\alpha$ and $\beta$. 
These are easily interpreted as the number of true and false samples, respectively. 
A uniform distrbution on the unit interval happens to coincide with a $\mbox{Beta}\left(1,1\right)$ distribution (one true and one false). 




# Probability Estimates


Suppose we'd like to estimate the probability of a given sample returning true. 
We start with a uniform, so  $\alpha=\beta=1$, and at first things are pretty boring:

```{r}
x <- seq(0,1,length=1000)
y <- dbeta(x,1,1)
plot(x, y, lwd=3, type='l', ylim=c(0,1), xlab="Probability estimate", ylab="density")
```

Now suppose we take 100 samples, of which 20 return true and 80 return false. 
$\alpha$ and $\beta$ just add, so now we have $\alpha=21$ and $\beta=81$:

```{r}
y <- dbeta(x,21,81)
plot(x, y, lwd=3, type='l', ylim=c(0,max(y)), xlab="Probability estimate", ylab="density")
```

If we have the quantile function for a beta, we can easily calculate a credible interval. 
For 99.9%, we would just do this:

```{r}
prob <- 0.999
plo <- (1 - prob)/2
phi <- 1 - plo
cred <- qbeta(c(plo, phi), 21, 81)
cred
```

The width of this interval is 

```{r}
diff(cred)
```

Note that the width does not only depend on the effective sample size ($\alpha + \beta$). 
If we had observed the same number of true and false, the width would have been

```{r}
diff(qbeta(c(plo, phi), 51, 51))
```

In general, having a "fair coin" like this will maximize the width of the credible interval.

# Count Estimates

We may want to reason not about the probability of a query in the region, but instead about the number of points for which the query is true. 
Back to our example with 20/100 true, suppose the sampled region contained 500 points. 
How many satisfy the query?

```{r}
plot(500*x, y/500, lwd=3, type='l', ylim=c(0,max(y/500)), xlab="Count estimate", ylab="density")
cred <- qbeta(c(plo, phi), 21, 81)*500
cred
```

Technically, this is a bit off. It's continuous, where we really need a discrete distribution. But it's simple to work with, and rounding it gives a very good approximation to what we're really after.

# Determining the Sample Size

How do we know how many samples to take? Well, the widest interval happens for a "fair coin", so that's our worst case scenario.
Let's assume the worst case, and see how many samples we'll need to achieve a given interval width:

```{r}
samples <- 10^seq(0,9, length=1000)
width = 1 - 2 * qbeta(plo, 1 + samples/2, 1 + samples/2)
plot(width, samples, log='xy', type='l', lwd=3)             
```

Somewhat surprisingly (should this be surprising?) this is nearly linear on a log-log scale, for anything beyond 100 or so samples. From this observation, we may not even need the GSL (sorry for the trouble, Jose). Next step is to get a more precise charachterization of this function, in order to be able to write this function in Ocaml. 